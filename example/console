#!/usr/local/bin/php
<?php

declare(strict_types=1);

use Chemaclass\FinanceYahoo\Domain\Crawler\JsonExtractor;
use Chemaclass\FinanceYahoo\Domain\Crawler\RootAppJsonCrawler;
use Chemaclass\FinanceYahoo\FinanceYahooConfig;
use Chemaclass\FinanceYahoo\FinanceYahooFacade;
use Chemaclass\FinanceYahoo\FinanceYahooFactory;
use Symfony\Component\HttpClient\HttpClient;

require_once dirname(__DIR__) . '/vendor/autoload.php';

Dotenv\Dotenv::createImmutable(__DIR__)->load();

$facade = new FinanceYahooFacade(
    new FinanceYahooConfig($_ENV['TICKERS']),
    new FinanceYahooFactory(HttpClient::create())
);

$siteCrawler = new RootAppJsonCrawler(
    new JsonExtractor\CompanyNameExtractor(),
    new JsonExtractor\PriceExtractor(),
    new JsonExtractor\TrendExtractor(),
    new JsonExtractor\NewsExtractor(),
);

$companies = $facade->crawlStock($siteCrawler);

// You can now do whatever you want with the crawled data :)

dump($companies);
